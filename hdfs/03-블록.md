# 블록

HDFS 파일은 지정한 크기의 블록으로 나누어지고, 각 블록은 독립적으로 저장된다.

HDFS의 블록은 128MB와 같이 매우 큰 단위이다. 블록이 큰 이유는 탐색 비용을 최소화할 수 있기 때문이다. 블록이 크면 하드디스크에스 볼록의 시작점을 탐색하는 데 걸리는 시간을 줄일 수 있고,
네트워크를 통해 데이터를 전송하는데 더 많은 시간을 할당할 수 있다. 따라서 여러 개의 블록으로 구성된 대용량 파일을 전송하는 시간은 디스크 IO 속도에 크게 영향을 받게된다.

## 블록 크기 파일 분할

- 블록 크기보다 작은 파일은 단일 블록으로 저장
    - 실제 파일 크기의 블록이 됨
- 블록 단위로 나누어 저장하기 때문에 디스크 사이즈보다 더 큰 파일을 보관할 수 있음

## 블록 추상화의 이점

- 파일 하나의 크기가 단일 디스크의 용량보다 더 커질 수 있다.
- 파일 단위보다 블록 단위로 추상화를 하면 스토리지의 서브 시스템을 단순하게 만들 수 있다.
    - 파일 탐색 지점이나 메타정보를 저장할 때 사이즈가 고정되어 있으므로 구현이 좀 더 쉽다.
- 장애를 복구하기 위해 필요한 복제(Replication)을 구현할 때 매우 적합하다.
    - 블록 단위로 복제를 구현하기 때문에 데이터 복제에도 어려움 없이 처리할 수 있다.
    - 같은 노드에 같은 블록이 존재하지 않도록 복제하여 노드가 고장일 경우 다른 노드의 블록으로 복구할 수 있다.

## 블록 지역성

맵리듀스를 이용한 분산 컴퓨팅은 블록의 지역성을 이용해 성능을 높인다. 맵리듀스를 처리할 때 현재 노드에 저장되어 있는 블록을 이용하는 지역 블록성을 통해 성능을 높일 수 있다.

- 네트워크를 이용한 데이터 전송 시간 감소
- 대용량 데이터 확인을 위한 디스크 탐색 시간 감소
- 적절한 단위의 블록 크기를 이용한 CPU 처리시간 증가

## 블록 작업 순서

1. 같은 노드에 있는 데이터
2. 같은 랙(Rack)의 노드에 있는 데이터
3. 다른 랙의 노드에 있는 데이터

## 블록 캐싱
데이터 노드에 저장된 데이터 중 자주 읽는 블록은 블록 캐시(block cache)라는 데이터 노드의 메모리에 명시적으로 캐싱할 수 있다. 파일 단위로 캐싱할 수도 있어서 조인에 사용되는 데이터들을 등록하여 읽기 성능을 높일 수 있다.
